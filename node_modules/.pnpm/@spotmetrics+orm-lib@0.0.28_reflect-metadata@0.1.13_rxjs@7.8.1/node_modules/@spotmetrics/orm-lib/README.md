# üì¶ @spotmetrics/orm-lib

Pacote destinado para realizar consultas em banco de dados postgres

## üöÄ Come√ßando

Essas instru√ß√µes permitir√£o que voc√™ obtenha uma c√≥pia do projeto em opera√ß√£o na sua m√°quina local para fins de desenvolvimento e teste.

Consulte **[Implanta√ß√£o](#-implanta%C3%A7%C3%A3o)** para saber como implantar o projeto.

### üìã Pr√©-requisitos

* [typescript](https://www.npmjs.com/package/typescript)
* [node](https://nodejs.org/en)


### üîß Instala√ß√£o

Para usar o pacote @spotmetrics/orm-lib, voc√™ precisa t√™-lo instalado em seu projeto. Para fazer isso, voc√™ pode executar o seguinte comando no terminal:

```bash
yarn add @spotmetrics/orm-lib
```

Ou, se voc√™ preferir usar o npm:

```bash
npm install @spotmetrics/orm-lib
```

## üì¶ Configura√ß√£o

Ap√≥s instalar o pacote @spotmetrics/orm-lib, voc√™ pode configur√°-lo para uso em seu projeto. Siga as etapas abaixo para configurar e utilizar a biblioteca de registro:

### 1. Definindo variavel de ambiente

Para configurar a conex√£o com o banco de dados no seu projeto, √© essencial definir uma vari√°vel de ambiente obrigat√≥ria chamada DATABASE_URL. Essa vari√°vel ser√° respons√°vel por conter as informa√ß√µes necess√°rias para estabelecer a conex√£o com o banco de dados PostgreSQL desejado.

Aqui est√° um exemplo de como voc√™ pode definir essa vari√°vel no arquivo .env do seu projeto:

```.env
DATABASE_URL=postgresql://usuario:senha@endereco_do_servidor/nome_do_banco_de_dados
```

Vamos entender o que cada parte dessa URL significa:

* **postgresql://**: Isso indica o tipo de banco de dados que voc√™ est√° usando, que neste caso √© o PostgreSQL.
* **usuario:** Substitua pelo nome de usu√°rio que voc√™ usa para acessar o banco de dados.
* **senha:** Coloque aqui a senha correspondente ao usu√°rio especificado.
* **endereco_do_servidor:** Insira o endere√ßo do servidor onde o banco de dados est√° hospedado. Pode ser um endere√ßo IP ou um dom√≠nio.
* **nome_do_banco_de_dados:** Especifique o nome do banco de dados ao qual voc√™ deseja se conectar.

Certifique-se de que todas as informa√ß√µes estejam corretas e correspondam √†s configura√ß√µes do seu banco de dados. Com essa vari√°vel de ambiente configurada, o seu aplicativo ser√° capaz de extrair automaticamente essas informa√ß√µes e estabelecer a conex√£o adequada com o banco de dados PostgreSQL.

Ao seguir essas instru√ß√µes e configurar corretamente a vari√°vel DATABASE_URL em seu projeto, voc√™ estar√° pronto para se conectar ao banco de dados PostgreSQL desejado de maneira segura e eficiente.

### Iniciando a Conex√£o com o Banco de Dados
Depois de definir a vari√°vel de ambiente conforme mencionado anteriormente, o pr√≥ximo passo √© estabelecer a conex√£o com o banco de dados. Para fazer isso, siga os passos abaixo:

1. Crie um Arquivo de Conex√£o: Dentro da pasta apropriada no seu projeto (como "loaders"), crie um novo arquivo. Por exemplo, voc√™ pode nome√°-lo database.js ou postgres.ts..

2. Importe o M√≥dulo de Conex√£o: No arquivo que voc√™ criou, importe o PgDatabaseService do pacote @spotmetrics/orm-lib

3. Crie uma Inst√¢ncia do Servi√ßo de Banco de Dados: Em seguida, crie uma inst√¢ncia do PgDatabaseService para que voc√™ possa us√°-lo para gerenciar a conex√£o com o banco de dados.

```ts
  import { PgDatabaseService } from '@spotmetrics/orm-lib';

  export const pg = new PgDatabaseService()
```

Agora voc√™ tem uma inst√¢ncia do servi√ßo de banco de dados pg que voc√™ pode usar para realizar v√°rias opera√ß√µes de banco de dados, como consultas, inser√ß√µes, atualiza√ß√µes, etc.

### Contruindo repositorios
Ao construir reposit√≥rios, o primeiro passo √© definir os modelos que representam a estrutura de dados que o reposit√≥rio ir√° tratar. Para isso, crie uma estrutura de pastas da seguinte forma:

```md
* src
  * repositories
    * models
      * TableExempleModel.ts
    * TableExempleRepository.ts
```
Aqui est√° o processo passo a passo para criar os modelos e o reposit√≥rio:

1. **Models:**

    dentro da pasta models vamos definir o modelo de dados da tabela que queremos fazer consulta 
    exemplo

    ```ts
    export interface TableExempleModel {
      id: number;
      txt_subject: string;
      txt_content: string;
      txt_name: string;
      dte_send: string;
      txt_description: string;
      flg_active: boolean
    }
    ```
2. **Repositorio**

    Dentro da pasta repositories, crie um arquivo para o reposit√≥rio. Vamos cham√°-lo de TableExempleRepository.ts.

    No in√≠cio deste arquivo, importe as depend√™ncias necess√°rias:
    ```ts
      import { BaseRepository } from "@spotmetrics/orm-lib/lib/src/base-repository";
      import { TableExempleModel } from "../models/TableExempleModel";
      import { pg } from "../loaders/postgres";
    ```

    Agora, vamos criar a classe do reposit√≥rio:
    ```ts
    class TableExempleRepository extends BaseRepository<TableExempleModel> {
      protected tableName(): string {
        return "tableexemple"; // Nome da tabela que ser√° utilizada para as consultas
      }

      async findById(input: { id: number }): Promise<any> {
        return await this.CRUD.findOne({
          id: input.id,
        });
      }
      // Adicione outros m√©todos de consulta aqui, conforme necess√°rio
    }
    ```

    Por fim, exporte uma inst√¢ncia do reposit√≥rio:
    ```ts
    const tableExempleRepository = new TableExempleRepository(pg);
    export { tableExempleRepository };
    ```

    Desta forma, voc√™ construiu um reposit√≥rio que utiliza o modelo TableExempleModel para interagir com a tabela "tableexemple" no banco de dados. Voc√™ pode adicionar mais m√©todos de consulta, como inser√ß√£o, atualiza√ß√£o e exclus√£o, √† medida que for necess√°rio.

    Certifique-se de que os nomes dos arquivos, classes e m√©todos estejam consistentes e que as depend√™ncias estejam corretamente importadas. Com esses passos conclu√≠dos, voc√™ ter√° um reposit√≥rio funcional para realizar opera√ß√µes no banco de dados usando os modelos definidos.

## üõ†Ô∏è Constru√≠do com

Aqui est√£o as ferramentas que foram utilizadas para criar este projeto:

[pg](https://www.npmjs.com/package/pg) - Um m√≥dulo do Node.js para interagir com o PostgreSQL.
[pg-format](https://www.npmjs.com/package/pg-format) - Uma biblioteca para formata√ß√£o de consultas PostgreSQL.

## üñáÔ∏è Colaborando

Se voc√™ encontrar problemas ou tiver sugest√µes de melhorias para o pacote `@spotmetrics/orm-lib`, sinta-se √† vontade para contribuir. Basta abrir um problema no reposit√≥rio do pacote no GitLab: [logger-lib](https://gitlab.wiseit.com.br/spotmetrics/orm-lib)

## üìÑ Licen√ßa

Este pacote √© licenciado como "UNLICENSED". Certifique-se de entender as implica√ß√µes disso antes de us√°-lo em seu projeto.

## Contato
Para mais informa√ß√µes ou d√∫vidas, entre em contato com a equipe de tecnologia Spot Metrics